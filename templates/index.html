<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trends in Data Science Tags</title>

    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Highcharts -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
</head>
<body>
    <div class="container">
        <h1>Data Science Tag Trends</h1>
        <div id="tag-buttons">
            <!-- tag buttons will be populated here -->
        </div>
        <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
    </div>

    <script>
        // This script will run when a tag button is clicked
        function fetchAndRenderData(tag) {
            $.getJSON('/api/tags/' + tag, function(data) {
                Highcharts.chart('container', {
                    chart: {
                        type: 'area'
                    },
                    title: {
                        text: 'Trends for ' + tag
                    },
                    xAxis: {
                        categories: data.map(item => item[0]), // years
                        tickmarkPlacement: 'on',
                        title: {
                            text: 'Year'
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Number of Questions'
                        },
                        labels: {
                            formatter: function () {
                                return this.value;
                            }
                        }
                    },
                    tooltip: {
                        split: true,
                        valueSuffix: ' questions'
                    },
                    series: [{
                        name: tag,
                        data: data.map(item => item[1]) // counts
                    }]
                });
            });
        }

        $(document).ready(function() {
            $.getJSON('/api/tags', function(data) {
                data.forEach(tag_info => {
                    var button = $('<button>')
                        .text(tag_info)  // update this line to correctly parse tag name
                        .click(function() { fetchAndRenderData(tag_info); }); // and this line too
                    $('#tag-buttons').append(button);
                });
            });
        });

    </script>

</body>
</html>
